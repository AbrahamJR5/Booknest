<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-10">

      <div class="card shadow-lg border-0 overflow-hidden">
        <div class="row g-0">

          <div class="col-md-5 bg-light d-flex flex-column align-items-center justify-content-center p-4">
            @if (libro) {
              <img [src]="'http://localhost:3000/uploads/' + libro.imagen"
                   class="img-fluid rounded shadow mb-3"
                   style="max-height: 300px; object-fit: cover;"
                   onerror="this.src='assets/images/book-placeholder.jpg'"
                   alt="{{ libro.titulo }}">
              <h4 class="fw-bold text-center text-dark-custom">{{ libro.titulo }}</h4>
              <p class="text-muted text-center">{{ libro.autor }}</p>
              <span class="badge bg-primary fs-6">{{ libro.categoria }}</span>
            } @else {
              <div class="spinner-border text-primary" role="status"></div>
            }
          </div>

          <div class="col-md-7 p-5">
            <h3 class="fw-bold text-primary-custom mb-4">Confirmar Reservación</h3>

            @if (mensaje) {
              <div class="alert alert-danger">{{ mensaje }}</div>
            }

            <form [formGroup]="reservarForm" (ngSubmit)="onSubmit()">

              <div class="mb-3">
                <label class="form-label text-muted">Usuario</label>
                <input type="text" class="form-control" [value]="authService.currentUser()?.nombre" disabled readonly>
              </div>

              <div class="mb-3">
                <label for="fecha" class="form-label fw-bold">¿Hasta cuándo lo necesitas?</label>
                <input type="date" id="fecha" formControlName="fecha_limite" class="form-control"
                       [ngClass]="{'is-invalid': reservarForm.get('fecha_limite')?.invalid && reservarForm.get('fecha_limite')?.touched}">
                <div class="invalid-feedback">
                  Debes seleccionar una fecha de devolución.
                </div>
                <div class="form-text">La fecha máxima permitida depende de la disponibilidad.</div>
              </div>

              <div class="mb-4">
                <label for="notas" class="form-label">Notas adicionales (Opcional)</label>
                <textarea id="notas" formControlName="notas" class="form-control" rows="2" placeholder="Ej: Lo recogeré por la tarde..."></textarea>
              </div>

              <div class="d-grid gap-2">
                <button type="submit" class="btn btn-primary-custom py-2" [disabled]="reservarForm.invalid">
                  Confirmar Reserva
                </button>
                <a routerLink="/catalogo" class="btn btn-outline-secondary py-2">Cancelar</a>
              </div>

            </form>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>
